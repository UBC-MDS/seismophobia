---
title: "Seismophobia EDA"
author: "Group 11 - Junghoo Kim, Dustin Burnham, Dustin Andrews, Trevor Kinsey"
date: "11/21/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r load libraries, message = FALSE}
library(tidyverse)
library(here)
library(ggthemes)
```

```{r raw data, message = FALSE}
earthquake <- read_csv(here('data', 'raw', 'earthquake_data.csv'))
glimpse(earthquake)
```

```{r minor data wrangling before EDA, message = FALSE}
earthquake_fct <- earthquake %>%
  rename(worry_earthquake = 'In general, how worried are you about earthquakes?',
         worry_big_one = 'How worried are you about the Big One, a massive, catastrophic earthquake?',
         think_lifetime_big_one = 'Do you think the "Big One" will occur in your lifetime?',
         experience_earthquake = 'Have you ever experienced an earthquake?',
         prepared_earthquake = 'Have you or anyone in your household taken any precautions for an earthquake (packed an earthquake survival kit, prepared an evacuation plan, etc.)?',
         familliar_san_andreas = 'How familiar are you with the San Andreas Fault line?',
         familiar_yellowstone = 'How familiar are you with the Yellowstone Supervolcano?',
         age = 'Age',
         gender = 'What is your gender?',
         household_income = 'How much total combined money did all members of your HOUSEHOLD earn last year?',
         us_region = 'US Region') %>%
  mutate_all(na_if,"") %>% 
  mutate_if(sapply(earthquake, is.character), as.factor)

earthquake_fct
```

```{r - prediction target}
earthquake_fct$worry_earthquake %>%
  levels()
```

```{r - Summary Tables}
earthquake_fct %>% 
  group_by(worry_earthquake) %>% 
  summarize(count = n()) %>% 
  knitr::kable()
```

```{r - Class Distribution}
earthquake_fct %>% 
  ggplot() +
    aes(x = worry_earthquake ,
        color = worry_earthquake,
        fill = worry_earthquake) +
  geom_histogram(stat = "count") +
  scale_fill_tableau() +
  scale_colour_tableau() +
  labs(x = "Worry Response",
       y = "Count",
       title = "Earthquake Worry Response Distribution") +
  theme(legend.title = element_blank(),
        axis.title.x=element_blank(),
        axis.text.x=element_blank(),
        axis.ticks.x=element_blank())
```


```{r - 2D Histograms, fig.height=7, fig.width=3}
earthquake_fct %>% 
  pivot_longer(!worry_earthquake, names_to = "feature", values_to = "value") %>% 
  add_count(worry_earthquake, feature, value) %>%
  ggplot() +
    aes(x = value, 
        y = worry_earthquake, 
        fill = n) +
  geom_tile(na.rm = TRUE) +
  facet_wrap(. ~ feature, scale = "free", ncol = 2) +
  scale_fill_viridis_c() +
  theme_bw() +
  theme(strip.text = element_text(size=10),
        axis.text = element_text(size = 8),
        axis.text.x = element_text(angle = 90))
```

```{r eda, message=FALSE, warning=FALSE}
# TODO: choose which correlations to show for EDA
library(GGally)
pairs_big <- earthquake_fct %>%
  ggpairs()

pairs_small <- earthquake_fct %>%
  select(c(worry_earthquake, experience_earthquake, prepared_earthquake, familliar_san_andreas, familiar_yellowstone, age, gender, household_income)) %>%
  ggpairs()

pairs_small
```
